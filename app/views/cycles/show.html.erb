<%= render 'layouts/partials/page_header' %>

<div class="row">
   <div class="col-lg-8">
      <!-- Main panel-->
      <%= render 'cycle_description' %>
      
      <!-- End Main panel-->
      <% if @cycle.status == "Open" %>
         <%= render 'recent_requests' %>
      <% elsif @cycle.status == "Closed" %>
         <%= render 'closed_cycle_requests' %>
      <% end %>

   </div>
   <div class="col-lg-4">
      <% if @cycle.status == "Open" %>
         <% @donut_name = "open_donut" %>
         <%= render 'cycle_breakdown', :name => @donut_name %>
      <% elsif @cycle.status = "Closed" %>
         <% @donut_name = "closed_donut" %>
         <%= render 'cycle_breakdown', :name => @donut_name %>
      <% end %>
   </div>
</div>

<script>
<% if @cycle.status == "Open" %>
   var donutData = [
      {label: "Created", value: <%= @createdRequests.count %>},
      {label: "Submitted",value: <%= @submittedRequests.count %>}
   ];
   $(document).ready(function(){
   new Morris.Donut({
      element: 'open_donut',
      data: donutData,
      colors: [ '#5d9cec', '#27c24c' ],
      resize: true
   });
})

<% elsif @cycle.status == "Closed" %>
   var donutData = [
      {label: "Submitted",value: <%= @submittedRequests.count %>},
      {label: "Incomplete", value: <%= @incompleteRequests.count %>},
      {label: "Under Review", value: <%= @underReviewRequests.count %>},
      {label: "Closed", value: <%= @closedRequests.count %>},
      {label: "Awarded", value: <%= @awardedRequests.count %>},
      {label: "Payment", value: <%= @paymentRequests.count %>},
      {label: "Complete", value: <%= @projectCompleteRequests.count %>}
   ];
<% end %>
$(document).ready(function(){
   new Morris.Donut({
      element: 'closed_donut',
      data: donutData,
      colors: [ '#5d9cec', '#000', '#ff902b', '#f05050', '#27c24c', '#F62459', '#6C7A89' ],
      resize: true
   });
})
</script>